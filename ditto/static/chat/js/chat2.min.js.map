{"version":3,"sources":["ditto/static/chat/js/chat2.jsx"],"names":[],"mappings":"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","file":"ditto/static/chat/js/chat2.jsx","sourcesContent":["import React from 'react';\n// TODO prob only load components we need?\nimport * as Bootstrap from \"vendor/react-bootstrap/index\";  // TODO shouldn't this work without /index?\n\nvar connection;\nvar composedMessageChangeAt;\nvar stillTypingTimeout = 5000;\nvar chatStatus = {\n    away: 'Away',\n    chat: 'Free for chat',\n    dnd: 'Do not disturb',\n    xa: 'Extended away',\n};\nvar update = React.addons.update;\nvar classSet = React.addons.classSet;\nvar ReactCSSTransitionGroup = React.addons.CSSTransitionGroup;\n\nvar getMessages = function (messages, other) {\n    return messages.filter(\n\tfunction (msg) {\n\t    return msg.from === other || msg.to === other;\n\t}\n    );\n};\n\nvar Chat = React.createClass({\n    getInitialState: function () {\n\treturn {\n\t    connectionStatus: 'connecting',\n\t    talkingTo: Strophe.getNodeFromJid(this.props.other || ''),\n\t    friends: [\n\t    ],\n\t    friendStatus: {},\n\t    messages: [\n\t    ],\n\t    chatroomMessages: [\n\n\t    ],\n\t    userMeta: {},\n\t    whosTyping: [],\n\t    chatroomPresence: [],\n\t};\n    },\n    getBareJID: function (node) {\n\tvar domain = Strophe.getDomainFromJid(this.props.me);\n\treturn node + '@' + domain\n    },\n    componentDidMount: function() {\n\tthis.connectToChatServer();\n    },\n    connectToChatServer: function () {\n\tconnection = new Strophe.Connection('ws://' + this.props.server + ':5280/ws-xmpp');\n\tif (this.props.hasOwnProperty('log')) {\n\t    connection.rawInput = function (data) { console.log('RECV: ', data); }\n\t    connection.rawOutput = function (data) { console.log('RECV: ', data); }\n\t}\n\tvar self = this;  // TODO better way these days?\n\tconnection.connect(\n\t    this.props.me,\n\t    this.props.password,\n\t    function (status) { self.onConnect(connection, status) }\n\t);\n    },\n    onConnect: function (connection, status_code) {\n\tvar status;\n\tif (status_code == Strophe.Status.CONNECTING) {\n\t    status = 'connecting';\n\t    \n\t} else if (status_code == Strophe.Status.CONNFAIL) {\n\t    status = 'failed to connect';\n\n\t} else if (status_code == Strophe.Status.DISCONNECTING) {\n\t    status = 'disconnecting';\n\n\t} else if (status_code == Strophe.Status.DISCONNECTED) {\n\t    status = 'disconnected';\n\n\t} else if (status_code == Strophe.Status.CONNECTED) {\n\t    status = 'connected';\n\n\t    connection.send($pres().tree());\n\t    connection.addHandler(this.handlePrivateMessage, null, 'message', 'chat',  null);\n\t    connection.addHandler(this.handlePresence, null, 'presence', null,  null); \n\t    \n\t    connection.mam.init(connection);\n\t    connection.mam.query(\n\t\tStrophe.getBareJidFromJid(this.props.me),\n\t\t{\n\t\t    // TODO load last N messages for each chat not across all chats\n\t\t    // 'with': Strophe.getBareJidFromJid(this.state.talkingTo),\n\t\t    'before': \"\",\n\t\t    'max': 50,\n\t\t    onMessage: this.handleArchivedPrivateMessage\n\t\t}\n\t    );\n\n\t    connection.roster.init(connection);\n\t    connection.roster.registerRequestCallback(this.acceptFriendRequest);\n\t    connection.roster.registerCallback(this.handleRoster);\n\t    connection.roster.subscribe(this.getBareJID(this.state.talkingTo));\n\t    connection.roster.get();\n\n\t    connection.vcard.init(connection);\n\t    this.getUserMeta(Strophe.getNodeFromJid(this.props.me));\n\n\t    connection.chatstates.init(connection);\n\n\t    connection.muc.init(connection);\n\t    connection.muc.join(\n\t\tthis.props.chatroom,\n\t\tthis.props.nick,\n\t\tthis.handleGroupMessage,\n\t\tthis.handleGroupPresence\n\t    );\n\n\t}\n\tthis.setState({connectionStatus: status});\n    },\n    switchChat: function (friend) {\n\tthis.setState({\n\t    talkingTo: friend,\n\t});\n    },\n    handlePresence: function (pres) {\n\tvar msg = $(pres);\n\tvar from = Strophe.getNodeFromJid(msg.attr('from'));\n\tvar type = msg.attr('type');\n\tvar code;\n\tvar customMessage;\n\tvar newState;\n\tvar status;\n\tvar friendStatus = {};\n\n\tif (type === 'unavailable') {\n\t    status = {};\n\t} else {\n\t    code = msg.find('show').text();\n\t    customMessage = msg.find('status').text();\n\t    status = {\n\t\tcode: code,\n\t\tmessage: customMessage\n\t    };\n\t}\n\tfriendStatus[from] = {$set: status};\n\tthis.setState(\n\t    update(\n\t\tthis.state,\n\t\t{friendStatus: friendStatus}\n\t    )\n\t);\n\treturn true;\n    },\n    setMyStatus: function (code, message) {\n\tconsole.log('setting status', code, message);\n\tvar pres = $pres();\n\tif (code) {\n\t    pres.c('show').t(code).up();\n\t}\n\tif (message) {\n\t    pres.c('status').t(message);\n\t}\n\tconnection.send(pres.tree());\n    },\n    handleArchivedPrivateMessage: function (msg) {\n\tvar msg = $(msg);\n\tif (msg.find('[type=groupchat]').length === 0) {\n\t    var body = msg.find(\"body:first\").text();\n\t    var from = Strophe.getNodeFromJid(msg.find('message').attr(\"from\"));\n\t    var to = Strophe.getNodeFromJid(msg.find('message').attr(\"to\"));\n\t    var when = new Date(msg.find('delay').attr('stamp'));\n\t    this.addMessage(\n\t\tfrom,\n\t\tto,\n\t\twhen,\n\t\tbody\n\t    );\n\t}\n\treturn true;\n    },\n    handlePrivateMessage: function (msg) {\n\tvar msg = $(msg);\n\tvar body = msg.find(\"body:first\").text();\n\tvar from = Strophe.getNodeFromJid(msg.attr(\"from\"));\n\tvar to = Strophe.getNodeFromJid(msg.attr(\"to\"));\n\tvar when = new Date();\n\tvar composing = msg.find('composing');\n\tvar active = msg.find('active');\n\tvar newState;\n\t\n\tif (composing.length) {\n\t    newState = update(this.state, {whosTyping: {$push: [from]}});\n\t    this.setState(newState);\n\t} else {\n\t    if (active.length) {\n\t\tnewState = update(this.state, {whosTyping: {$splice: [[this.state.whosTyping.indexOf(from), 1]]}});\n\t\tthis.setState(newState);\n\t    }\n\t    if (body) {\n\t\tif (this.props.page !== 'messages' || this.isPageHidden()) {\n\t\t    this.notifyNewMessage(body);\n\t\t}\n\t\tthis.addMessage(\n\t\t    from,\n\t\t    to,\n\t\t    when,\n\t\t    body\n\t\t);\n\t    }\n\t}\n\treturn true;\n    },\n    isPageHidden: function () {\n\t// TODO keep this kind of things to existing polyfills (loaded with modernizr?)?\n\treturn document.hidden || document.webkitHidden || document.mozHidden || document.msHidden;\n    },\n    notifyNewMessage: function (msg) {\n\tconsole.log('playing beep');\n\tdocument.getElementById('new-message-beep').play();\n\tvar notification = new Notification(\"New message\", {\n\t    icon : \"/static/images/ditto-logo.png\",\n\t    body: msg.slice(0, 140)\n\t});\n\t// TODO this is supposed to go to the right tab in chrome but doesn't seem to work\n\tnotification.onclick = function () {\n\t    window.focus();\n\t};\n    },\n    handleGroupMessage: function (msg) {\n\tvar msg = $(msg);\n\tvar body = msg.find(\"body:first\").text();\n\tvar from = Strophe.getResourceFromJid(msg.attr(\"from\"));\n\tvar when = msg.find('delay');\n\tif (when.length) {\n\t    when = new Date(when.attr('stamp'));\n\t} else {\n\t    when = new Date();\n\t}\n\tif (from) {\n\t    // TODO always get an 'empty' message from the room\n\t    // itself, not sure why\n\t    this.addGroupMessage(\n\t\tfrom,\n\t\twhen,\n\t\tbody\n\t    )\n\t}\n\treturn true;\n    },\n    handleGroupPresence: function (pres) {\n\tvar msg = $(pres);\n\tvar nick_taken = msg.find('conflict');\n        var from = msg.attr('from').split('/')[1];\n\tvar newState;\n\tif (nick_taken.length) {\n\t    // TODO do something with this\n\t}\n\tvar added = msg.find('item[role!=none]');\n\tif (added.length) {\n\t    newState = update(this.state, {chatroomPresence: {$splice: [[0, 0, from]]}});\n\t}\n\tvar removed = msg.find('item[role=none]');\n\tif (removed.length) {\n\t    newState = update(this.state, {chatroomPresence: {$splice: [[this.state.chatroomPresence.indexOf(from), 1]]}});\n\t}\n        // First time we enter the chatroom for a new network the room\n        // needs to be created and configured\n        var is_new_room = msg.find('status[code=201]');\n        if (is_new_room.length) {\n            // TODO handle failure\n            connection.muc.createInstantRoom(this.props.chatroom);\n        }\n\tthis.setState(newState);\n\treturn true;\n    },\n    handleMessageSubmit: function (message) {\n\tif (this.props.page === 'chatroom') {\n\t    connection.muc.groupchat(this.props.chatroom, message);\n\t} else {\n\t    var payload = $msg({\n\t\tto: this.getBareJID(this.state.talkingTo),\n\t\tfrom: this.props.me,\n\t\ttype: 'chat'\n\t    }).c('body').t(message);\n\t    \n\t    connection.chatstates.addActive(payload);\n\t    composedMessageChangeAt = null;\n\t    \n\t    connection.send(payload.tree());\n\t    // TODO functions have kwargs in es6?\n\t    // TODO handle error on message submit\n\t    this.addMessage(\n\t\tStrophe.getNodeFromJid(this.props.me),\n\t\tthis.state.talkingTo,\n\t\tnew Date(),\n\t\tmessage\n\t    );\n\t}\n    },\n    handleMessageChange: function () {\n\tif (!composedMessageChangeAt) {\n\t    connection.chatstates.sendComposing(\n\t\tthis.getBareJID(this.state.talkingTo)\n\t    );\n\t    composedMessageChangeAt = new Date();\n\t    setTimeout(this.checkImStillTyping, stillTypingTimeout);\n\t}\n    },\n    checkImStillTyping: function () {\n\tif (composedMessageChangeAt) {\n\t    var now = new Date();\n\t    if (now - composedMessageChangeAt > stillTypingTimeout) {\n\t\tcomposedMessageChangeAt = undefined;\n\t\tconnection.chatstates.sendActive(\n\t\t    this.getBareJID(this.state.talkingTo)\n\t\t);\n\t    } else {\n\t\twindow.setTimeout(this.checkImStillTyping, stillTypingTimeout);\n\t    }\n\t}\n    },\n    acceptFriendRequest: function (from) {\n\tconnection.roster.authorize(from);\n\treturn true;\n    },\n    handleRoster: function (roster, item) {\n\tvar friends = [];\n\tvar newState;\n\tvar self = this;\n\t$.each(roster, function (i, friend) {\n\t    var username = Strophe.getNodeFromJid(friend.jid);\n\t    if (friend.subscription === 'both') {\n\t\tfriends.push(username);\n\t\tself.getUserMeta(username);\n\t    }\n\t});\n\tnewState = update(this.state, {friends: {$set: friends}});\n\tif (!this.state.talkingTo && friends) {\n\t    newState = update(newState, {talkingTo: {$set: friends[0]}});\n\t}\n\tthis.setState(newState);\n\treturn true;  // always bloody forget this!\n    },\n    getUserMeta: function (user) {\n\tvar jid = this.getBareJID(user);\n\tif (this.state.userMeta[user]) {\n\t    return;\n\t}\n\tconnection.vcard.get(\n\t    vcard => {\n\t\tvcard = $(vcard);\n\t\tvar setUserMeta = {};\n\t\tvar newState;\n\t\tvar role = vcard.find('ROLE').text();\n\t\tvar avatar = vcard.find('PHOTO').text();\n\t\tsetUserMeta[user] = {$set: {role: role, avatar: avatar}};\n\t\tnewState = update(this.state, {userMeta: setUserMeta})\n\t\tthis.setState(newState);\n\t    },\n\t    jid\n\t);\n    },\n    addMessage: function (from, to, when, message) {\n\tvar newState;\n\tnewState = update(this.state,\n\t    {messages: {\n\t\t$push: [{\n\t\t\tfrom: from,\n\t\t\tto: to,\n\t\t\twhen: when,\n\t\t\tmessage: message\n\t\t}]\n\t    }}\n\t);\n\tthis.setState(newState);\n    },\n    addGroupMessage: function (from, when, message) {\n\tvar newState;\n\tnewState = update(this.state,\n\t    {chatroomMessages: {\n\t\t$push: [{\n\t\t    from: from,\n\t\t    when: when,\n\t\t    message: message\n\t\t}]\n\t    }}\n\t);\n\tthis.setState(newState);\n    },\n    render: function () {\n\tvar messages;\n\tif (!this.props.page) {\n\t    // For now we have some pages with no chat UI elements but\n\t    // we're still connected to chat so we can, for example, beep\n\t    // on new messages. TODO maybe that should be separated out\n\t    // from the react stuff?\n\t    return <div></div>;\n\t} else if (this.state.connectionStatus !== 'connected') {\n\t    return (\n\t\t<div>\n\t\t    {this.state.connectionStatus}\n\t\t</div>\n\t    );\n\t} else if (this.props.page === 'chatroom') {\n\t    return (\n\t\t<div className=\"row\">\n    \t\t    <div className=\"col-md-8\">\n    \t\t\t<Messages me={Strophe.getNodeFromJid(this.props.me)} talkingTo={this.state.talkingTo} messages={this.state.chatroomMessages} userMeta={this.state.userMeta} />\n\t\t\t<div className=\"row msgbar\">\n      \t\t\t    <ComposeMessage onMessageSubmit={this.handleMessageSubmit} onMessageChange={this.handleMessageChange} />\n\t\t\t</div>\n    \t\t    </div>\n\t\t    <div className=\"col-md-4\">\n\t\t\t<ChatroomPresence users={this.state.chatroomPresence}/>\n\t\t    </div>\n\t\t</div>\n\t    );\n\t} else if (this.props.page === 'messages') {\n\t    messages = getMessages(this.state.messages, this.state.talkingTo);\n\t    return (\n    \t\t<div className=\"row\">\n    \t\t    <div className=\"col-md-4\">\n\t\t\t<div className=\"list-group\">\n    \t\t\t    <Friends messages={this.state.messages} friends={this.state.friends} friendStatus={this.state.friendStatus} current={this.state.talkingTo} switchChat={this.switchChat} userMeta={this.state.userMeta} />\n\t\t\t</div>\n    \t\t    </div>\n    \t\t    <div className=\"col-md-8\">\n    \t\t\t<Messages me={Strophe.getNodeFromJid(this.props.me)} talkingTo={this.state.talkingTo} messages={messages} userMeta={this.state.userMeta} />\n    \t\t\t<WhosTyping users={this.state.whosTyping} />\n\t\t\t<div className=\"row msgbar\">\n    \t\t\t    <ComposeMessage onMessageSubmit={this.handleMessageSubmit} onMessageChange={this.handleMessageChange} />\n\t\t\t    <MyStatus setStatus={this.setMyStatus} />\n\t\t\t</div>\n    \t\t    </div>\n    \t\t</div>\n\t    );\n\t} else {\n\t    return (\n\t\t<WhosOnline users={this.state.chatroomPresence} userMeta={this.state.userMeta} />\n\t    );\n\t}\n    }\n});\n\nvar WhosOnline = React.createClass({\n    usersPerPanel: 9,\n    groupUsers: function (users) {\n\tvar grouped = [];\n\tvar group;\n\tusers.forEach((user, i) => {\n\t    if (i % this.usersPerPanel === 0) {\n\t\tgroup = [];\n\t\tgrouped.push(group);\n\t    }\n\t    group.push(user);\n\t});\n\treturn grouped;\n    },\n    render: function () {\n\tvar userMeta = this.props.userMeta;\n\tvar groupedUsers = this.groupUsers(this.props.users);\n\tvar items = groupedUsers.map((group, i) => {\n\t    return (\n\t\t<Bootstrap.CarouselItem key={i}>\n\t\t    <WhosOnlineItem users={group} userMeta={this.props.userMeta} key={i} />\n\t\t</Bootstrap.CarouselItem>\n\t    );\n\t});\n\treturn (\n\t    <div className=\"row\">\n\t\t<div className=\"col-md-4 whosonline\">\n\t\t    <Bootstrap.Carousel interval={false}>\n\t\t\t{items}\n\t\t    </Bootstrap.Carousel>\n\t\t</div>\n\t    </div>\n\t);\n    }\n});\n\nvar WhosOnlineItem = React.createClass({\n    render: function () {\n\tvar users = this.props.users.map((user, i) => {\n\t    return (\n\t\t<div className=\"avatar\" key={i}>\n\t\t    <Avatar size={100} user={user} userMeta={this.props.userMeta} />\n\t\t    <p>{user}</p>\n\t\t</div>\n\t    );\n\t});\n\treturn (\n\t    <div>\n\t\t{users}\n\t    </div>\n\t);\n    }\n});\n\nvar ChatroomPresence = React.createClass({\n    render: function () {\n\tvar memberNodes = this.props.users.map(function (user) {\n\t    return (\n\t\t<li className=\"list-group-item\" key={user}>\n                    <div className=\"media\">\n\t\t\t<div className=\"media-left media-middle\">\n\t\t\t</div>\n\t\t\t<div className=\"media-body\">\n                            <h4 className=\"media-heading\">{user}</h4>\n\t\t\t</div>\n\t\t    </div>\n\t\t</li>\n\t    );\n\t});\n\treturn (\n            <ul className=\"list-group\">\n\t\t{memberNodes}\n            </ul>\n\t);\n    }\n});\n    \nvar MyStatus = React.createClass({\n    getInitialState: function() {\n\treturn {\n\t    status: '',\n\t    message: '',\n\t};\n    },\n    handleMessageChange: function(event) {\n\tthis.setState({message: event.target.value});\n    },\n    handleStatusChange: function (e) {\n\te.preventDefault();\n\tvar message = this.refs.message.getDOMNode().value.trim();\n\tvar code = this.refs.status.getDOMNode().value;\n\tthis.props.setStatus(code, message);\n    },\n    render: function () {\n\tvar options = [];\n\tfor (var code in chatStatus) {\n\t    options.push(<option value={code} key={code}>{chatStatus[code]}</option>);\n\t}\n\treturn (\n\t    <form onSubmit={this.handleStatusChange}>\n\t\t<div className=\"col-md-2\">\n\t\t    <input className=\"form-control\" value={this.state.message} onChange={this.handleMessageChange} type=\"text\" placeholder=\"Type your custom status message here...\" ref=\"message\" />\n\t\t</div>\n\t\t<div className=\"col-md-2\">\n\t\t    <select className=\"form-control\" ref=\"status\">\n\t\t\t<option value=\"\">Online</option>\n\t\t\t{options}\n\t\t    </select>\n\t\t</div>\n\t\t<div className=\"col-md-1\">\n\t\t    <input className=\"form-control btn btn-success\" type=\"submit\" value=\"Set status\" />\n\t\t</div>\n\t    </form>\n\t);\n    }\n});\n\nvar Friends = React.createClass({\n    render: function () {\n\tvar self = this;\n\tvar friendNodes = this.props.friends.map(function(friend, index) {\n\t    var isCurrent = self.props.current === friend;\n\t    var status = self.props.friendStatus[friend];\n\t    var lastMessage = getMessages(self.props.messages, friend).pop();\n\t    return (\n\t\t<Friend isCurrent={isCurrent} friend={friend} status={status} lastMessage={lastMessage} key={index} switchChat={self.props.switchChat} userMeta={self.props.userMeta} />\n\t    );\n\t});\n\treturn (\n\t    <div>\n\t\t{friendNodes}\n\t    </div>\n\t);\n    }\n});\n\nvar Friend = React.createClass({\n    switchChat: function (e) {\n\te.preventDefault();\n\tthis.props.switchChat(this.props.friend);\n    },\n    render: function () {\n\tvar current, status = '', lastMessage;\n\tif (this.props.isCurrent) {\n\t    current = (\n\t\t<span> * </span>\n\t    );\n\t}\n\tif (this.props.status && this.props.status.hasOwnProperty('code')) {\n\t    status = <FriendStatus code={this.props.status.code} message={this.props.status.message} />;\n\t} else {\n\t    status = <p>Offline</p>;\n\t}\n\treturn (\n\t    <a className=\"list-group-item\" href=\"#\" onClick={this.switchChat}>\n\t\t<div className=\"media-left media-middle friends-avatar\">\n\t\t    <Avatar size={50} user={this.props.friend} userMeta={this.props.userMeta} />\n\t\t</div>\n\t\t<div className=\"media-body\">\n\t\t    <h4 className=\"media-heading friends-username\">{current} {this.props.friend}</h4>\n\t\t    {status}\n\t\t    <LastMessage message={this.props.lastMessage} />\n\t\t</div>\n\t    </a>\n\t);\n    }\n});\n\nvar LastMessage = React.createClass({\n    render: function () {\n\tif (this.props.message) {\n\t    return <div>\n\t\t{this.props.message.message} <small><Timestamp when={this.props.message.when} /></small>\n\t    </div>;\n\t} else {\n\t    return <div></div>;  // TODO empty component a thing?\n\t}\n    }\n});\n\nvar FriendStatus = React.createClass({\n    render: function () {\n\tvar status = chatStatus[this.props.code] || 'Online';\n\treturn (\n\t    <p>{status} <em>{this.props.message}</em></p>\n\t);\n    }\n});\n\n\nvar Chatroom = React.createClass({\n    render: function () {\n\tvar current;\n\tif (this.props.isInside) {\n\t    current = (\n\t\t<span> * </span>\n\t    );\n\t}\n\treturn (\n\t    <a className=\"list-group-item\" onClick={this.props.show} href=\"#\">\n\t\t{current} Chatroom\n\t    </a>\n\t);\n    }\n});\n\nvar Messages = React.createClass({\n    getInitialState: function () {\n\treturn {height: ''};\n    },\n    componentDidMount: function () {\n\t// TODO window.onresize cross-browser?\n\twindow.onresize = this.updateHeight;\n    },\n    updateHeight: function () {\n\t// TODO no pure css way to do this?\n\t// Note, tried to calculate the height from other dom elements but it's easier just to hardcode this vaule and change it when the css changes\n\tvar height = $(window).height() - 160;\n\tdebugger;\n\tthis.setState({height: height});\n    },\n    componentWillMount: function () {\n\tthis.updateHeight();\n    },\n    componentWillUnmount: function () {\n\t// TODO window.remove event listener\n    },\n    componentDidUpdate: function() {\n\tvar node = this.getDOMNode();\n\tnode.scrollTop = node.scrollHeight;\n    },\n    render: function () {\n\tvar userMeta = this.props.userMeta;\n\tvar self = this;\n\tvar messageNodes = this.props.messages.map(function(m, i) {\n\t    // TODO this key should be unique across all messages, how do I do that?\n\t    return (\n\t\t<Message me={self.props.me} from={m.from} to={m.to} message={m.message} when={m.when} userMeta={userMeta} key={m.when} />\n\t    );\n\t});\n\tvar style = {height: this.state.height}\n\treturn (\n\t    <div style={style} id=\"msgs\" ref=\"messages\">\n\t    <ReactCSSTransitionGroup transitionName=\"example\">\n\t\t{messageNodes}\n\t    </ReactCSSTransitionGroup>\n\t    </div>\n\t);\n    }\n});\n\nvar Message = React.createClass({\n    render: function () {\n\tvar left_avatar, right_avatar;\n\tvar is_from_me = this.props.from === this.props.me;\n\tvar mediaClass = classSet({\n\t    'media-left': !is_from_me,\n\t    'media-right': is_from_me\n\t});\n\tvar avatar = <div className={mediaClass}>\n    \t\t<Avatar size={50} user={this.props.from} userMeta={this.props.userMeta} />\n\t</div>;\n\tvar colClass = classSet({\n\t    'col-md-6': true,\n\t    'col-md-offset-6': is_from_me\n\t});\n\tif (is_from_me) {\n\t    right_avatar = avatar;\n\t} else {\n\t    left_avatar = avatar;\n\t}\n\treturn (\n\t    <div className=\"row\">\n\t\t<div className={colClass}>\n\t\t    <div className=\"media\">\n\t\t\t{left_avatar}\n\t\t\t<div className=\"media-body\">\n\t\t\t    <h4 className=\"media-heading\">{this.props.from} <small><Timestamp when={this.props.when}/></small></h4>\n\t\t\t    {this.props.message}\n\t\t\t</div>\n\t\t\t{right_avatar}\n\t\t    </div>\n\t\t</div>\n\t    </div>\n\t);\n    }\n});\n\nvar WhosTyping = React.createClass({\n    render: function () {\n\tvar nodes = this.props.users.map((user, i) =>\n\t    <p key={i}>{user} is typing ...</p>\n\t);\n\treturn (\n\t    <div>{nodes}</div>\n\t);\n    }\n});\n\nvar Avatar = React.createClass({\n    render: function () {\n\t// TODO where to put global constant state like this?\n\tvar avatarSVGs = $('#avatar_svgs').text();\n\tvar avatarName;\n\tvar meta = this.props.userMeta[Strophe.getBareJidFromJid(this.props.user)];\n\tif (meta) {\n\t    avatarName = meta.avatar;\n\t} else {\n\t    avatarName = 'cupcake'\n\t}\n\t// TODO better way to generate svg without jquery/outerHTML, convert svg to react component?\n\tvar avatarSVG = $(avatarSVGs);\n\tif (avatarName) {\n\t    avatarSVG.find('>g[id!=' + avatarName + ']').remove();\n\t    avatarSVG.find('>g').show();\n\t    avatarSVG.attr({\n\t\twidth: this.props.size,\n\t\theight: this.props.size\n\t    });\n\t    avatarSVG = avatarSVG.get(0).outerHTML;\n\t} else {\n\t    avatarSVG = '';\n\t}\n\treturn (\n\t    <div className=\"avatar\">\n\t\t<div dangerouslySetInnerHTML={{__html: avatarSVG}} />\n\t    </div>\n\t);\n    }\n});\n\nvar Timestamp = React.createClass({\n    componentDidMount: function() {\n\tthis.interval = setInterval(this.updateDelta, 60 * 1000);\n    },\n    componentWillUnmount: function () {\n\tclearInterval(this.interval);\n    },\n    updateDelta: function () {\n\t// TODO this doesn't feel right\n\tthis.setState({});\n    },\n    // TODO prob library for this\n    timeAgo: function (date) {\n\tvar delta = new Date() - date;\n\tif (delta < 60000) {\n\t    return 'less than a minute ago';\n\t}\n\tif (delta < 3600 * 1000) {\n\t    var minutes = delta / (60 * 1000);\n\t    return Math.floor(minutes) + ' minutes ago';\n\t}\n\tif (delta < 2 * 3600 * 1000) {\n\t    return 'about an hour ago';\n\t}\n\treturn 'ages ago';\n    },\n    render: function () {\n\tvar when = this.props.when;\n\tvar delta = this.timeAgo(when);\n\treturn (\n\t    <time dateTime={when.toISOString()}>{delta}</time>\n\t);\n    }\n});\n\nvar ComposeMessage = React.createClass({\n    getInitialState: function() {\n\treturn {value: ''};\n    },\n    handleChange: function(event) {\n\tthis.setState({value: event.target.value});\n\tthis.props.onMessageChange();\n    },\n    handleSubmit: function(e) {\n\te.preventDefault();\n\tvar message = this.refs.message.getDOMNode().value.trim();\n\tif (!message) {\n\t    return;\n\t}\n\tthis.props.onMessageSubmit(message);\n\tthis.setState({value: ''});\n\treturn;\n    },\n    render: function() {\n\treturn (\n\t    <form onSubmit={this.handleSubmit}>\n\t\t<div className=\"col-md-6\">\n\t\t    <input className=\"form-control\" value={this.state.value} onChange={this.handleChange} type=\"text\" placeholder=\"Type your message here...\" ref=\"message\" />\n\t\t</div>\n\t\t<div className=\"col-md-1\">\n\t\t    <input className=\"btn btn-success\" type=\"submit\" value=\"Say it!\" />\n\t\t</div>\n\t    </form>\n\t);\n    }\n});\n\nvar render = function () {\n    React.render(\n\t<Chat server={chatConf.server} me={chatConf.me} password={chatConf.password} other={chatConf.other} chatroom={chatConf.chatroom} nick={chatConf.nick} page={chatConf.page} />,\n\tdocument.getElementById(chatConf.element)\n    );\n}\nexport default render;\n"]}