{% extends "base.html" %}
{% load avatar_tags %}
{% load static %}

{% block title %}User: {{ object.username }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-9 main-content">
        <div class="row">
            <div class="col-md-4 avatar-profile">
                {% if not is_me %}
                <h1>{{ object.username }} is {% include "chat/_chat_partner_status.html" %}</h1>
                {% endif %}
                <div class="media">
                    <div class="media-left media-middle">
                        <div data-avatar="sunshine" data-name="{{ object.username }}" data-size="100"></div><!-- TODO sort out avatars.html so we can render without js too -->
                    </div>
                    <div class="media-body">
                        <h4 class="media-heading">{{ object.username }}</h4>
                    </div>
                </div>
                <h2>{{ object.groups.all.0.name }}</h2>
                <p><strong>Joined: </strong> {{ object.date_joined }}</p>
                {% if is_me %}
                <div class="btn-group">
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                        Change avatar <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu">
                        {% include "skin/avatars.html" %}
                    </ul>
                </div>
                {% endif %}
            </div>
            <div class="col-md-8">
                {% if not is_me %}
                <ul class="comms-list nav nav-pills nav-justified">
                    {% include "users/_comm_button.html" with label="Chat" %}
                    {% include "users/_comm_button.html" with label="Video" %}
                    {% include "users/_comm_button.html" with label="Audio" %}
                </ul>
                {% endif %}
                
                {% with accordion_id='user_content' %}
                <div class="panel-group" id=accordion_id role="tablist" aria-multiselectable="true">
                    {% include "users/_bio.html" with index=0 %}
                    {% include "users/_blog.html" with index=1 %}
                </div>
                {% endwith %}
            </div>
        </div>
    </div>
    <div class="col-md-3 main-sidebar">
        {% with accordion_id='user_meta' footer=1 %}
        <div class="panel-group" id=accordion_id role="tablist" aria-multiselectable="true">
            {% if is_me %}{% include "users/_chats.html" with index=0 %}{% endif %}
            {% include "ditto/module/chatroom.html" with index=1 %}
            {% include "users/_activity.html" with index=2 %}
        </div>
        {% endwith %}
    </div>
</div>
{% endblock content %}

{% block strophe-plugins %}
    {{ block.super }}
    <script src="{% static 'vendor/strophe.rsm.js' %}"></script>
    <script src="{% static 'vendor/strophe.mam.v0.2.js' %}"></script>
    <script src="{% static 'vendor/strophe.chatstates.js' %}"></script>
    <script src="{% static 'vendor/strophe.roster.js' %}"></script>
{% endblock %}

{% block config %}
    {{ block.super }}
    DITTO.chatee = '{{ object.username }}@' + DITTO.chat_host;
{% endblock %}

{% block plugins %}
    {{ block.super }}    
    <script src="{% static 'chat/js/composing.js' %}"></script>
    <script src="{% static 'chat/js/presence.js' %}"></script>
    <script src="{% static 'chat/js/mam.js' %}"></script>
{% endblock %}
